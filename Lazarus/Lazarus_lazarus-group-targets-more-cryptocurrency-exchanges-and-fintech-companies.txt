introduction
cyber attacks from the lazarus group, a threat actor associated with north korea, has not slowed down and their malware toolset continues to evolve. a few months ago, we published a general research of the lazarus group and the blockbuster campaign including code reuse and similarities throughout their malware up until the latest news regarding targeting bitcoin and cryptocurrency exchanges. in recent attacks, the lazarus group has been spreading malicious documents with a rat embedded inside that gets executed through a vba macro. these malicious documents contained a job description for different positions in various industries. through our research, we came across a new malicious document where we have found changes and a continuation to their campaign targeting potential cryptocurrency exchanges, fintech, financial companies, and others who might be involved with cryptocurrencies. the malicious document came embedded with an upgraded and revamped version of a rat they have added to their arsenal. infection vector
the malicious document s original creation name is investment and attempts to impersonate an employee of an australia based law firm for commercial and financial services named holley nethercote. the document states that they have evaluated several cryptocurrencies and they have put together an investment proposal aimed at fintech, financial, and other companies who might be interested in taking an investment. as can be seen in the photos of the document below, the document is of very low quality, meaning there are inconsistencies and typos everywhere in a document supposedly from a law firm. the first page contains a basic description of what the investment proposal involves. take note of the name kate harris, a director from holley nethercote, by whom the document was supposedly written. the second page is a general description of the company holley nethercote which is directly taken from the first page of a pdf on the company s website. the third page is a list of their employees and staff as can also be found on their website. remember kate harris, the director, from before? shockingly enough, she does not exist on this list. the fourth page contains a chart of various cryptocurrencies and random values associated with them. the interesting point here is the date of a bitcoin price that it mentions from february 9th, 2018 which helps us put on a timeline of when this malicious document was originally created. the fifth page states how they would like to invest $50m in the company that received this document and contains some typos like out instead of our and other grammatical errors. the sixth page is a very poorly written document supposedly signed by the ceo of holley nethercote involving the investment proposition. it also contains various typos and grammatical errors with the general flow not making sense. the seventh and last page contains some fake contact information including a phone number from the uk that is from an online service that allows you to receive an sms through the website. technical details
upon launching the document, an obfuscated vba macro is executed to drop and execute an embedded remote access tool. (embedded vba macro) the embedded rat is dropped to and executed from %userprofile% . more evidence besides the date in the content of the document, pointing to this malware out in february is that we can also see the compilation timestamp is from february 14, 2018 and the upload date was on march 2, 2018. after uploading the rat to intezer analyze , we found 4% of the code to have been used in previous malware attributed to the lazarus group, but 85% of the code base is completely unique. this says to us that they made some changes to their code. ( ) the first code that gets executed within the rat first decrypts a locally created, xor encrypted buffer of names of modules and imports that it resolves via getprocaddress. resolving the binary s own imports in this manner is very common in many of the previous lazarus attributed malware. next, the rat creates a shortcut of itself to %userprofile%\start in order to maintain persistence and sets the attributes of itself using setfileattributesw to hidden | system | normal. inside of the function that is used for setting up the persistence, we can find a call to a function that is responsible for decrypting a buffer containing multiple wide strings used throughout the binary. as can be seen in the function, it uses a very basic decryption routine to decrypt the locally stored buffer. the decrypted buffer is as follows: the parameter to the function responsible for decrypting this buffer is an offset to grab a string from this decrypted buffer by multiplying it by two, since these are wide strings. strangely enough, a lot of these strings are not used anywhere in the binary. by the strings, you can see there is an intention of including a simple anti-vm technique to detect virtualbox. there is also one more function located within the binary, responsible for the same functionality with a different buffer containing different strings. following all of this, the rat then creates a backdoor which then waits to receive commands from the various c&c servers. the c&c handler used to follow a pattern of command ids but it appears to have changed to random command values and contains commands with new functionality. their handler is able to handle 22 different commands and the descriptions of each can be found in the chart below. the binary uses wolfssl to encrypt the network traffic containing two different certificates and one private key. the certificates are stored in a local buffer of a function located within the binary. conclusion
as we can see, the blockbuster campaign and the lazarus group are still active and have shown a continued interest in cryptocurrencies and companies surrounding cryptocurrency. numerous exchanges are believed to have been hacked by the lazarus group and there has been a significant amount of money stolen by doing so. since their efforts have been so successful, it does not look like they will slow down anytime soon with these types of targets.
