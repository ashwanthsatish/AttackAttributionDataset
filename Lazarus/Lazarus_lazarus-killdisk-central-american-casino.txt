our analysis shows that the cybercriminals behind the attack against an online casino in central america, and several other targets in late-2017, were most likely the infamous lazarus hacking group. in all of these incidents the attackers utilized similar toolsets, including killdisk; the disk-wiping tool that was executed on compromised machines. lazarus toolset
the lazarus group was first identified in novetta s report operation blockbuster in february 2016; us cert and the fbi call this group hidden cobra. these cybercriminals rose into prominence with the infamous case of cyber-sabotage against sony pictures entertainment. some of the past attacks attributed to the lazarus group attracted the interest of security researchers who relied on novetta et al s white papers with hundreds of pages describing the tools used in the attacks the polish and mexican banks; the wannacryptor outbreak; phishing campaigns against us defense contractors, etc and provides grounds for the attribution of these attacks to the lazarus group. note that the lazarus toolset (i.e. the collection of all files that are considered by the security industry as fingerprints of the group s activity) is quite broad, and we believe there are numerous subgroups. unlike toolsets used by some other cybercriminal groups, none of the source code of any lazarus tools has ever been disclosed in a public leak. on top of custom tools, the lazarus group also leverages projects that are either available from github or provided commercially. lazarus tools in casino attack
in this section, we review some of the tools that were detected on numerous servers and endpoints in the network of an online casino in central america. these were used in conjunction with the destructive killdisk samples described later. we explain why we believe they are linked to lazarus. eset detects known lazarus malware as win32/nukesped or win64/nukesped. almost all of these tools are designed to run as a windows service. administrator privileges are necessary to achieve this, which means the attackers expected to have to have those privileges at the time of tool design or compilation. tcp backdoor
win64/nukesped.w is a console application that is installed in the system as a service. one of the initial execution steps is dynamically resolving the required dll names, on the stack: likewise, procedure names of windows apis are constructed dynamically. in this particular sample, they are visible in plaintext; in other past samples that we ve analyzed they were base64-encoded, encrypted or resolved on the stack character by character: both are typical traits of lazarus malware. another typical lazarus backdoor characteristic is also seen in this backdoor: it listens on a specific port that it ensures is not blocked by the firewall: the backdoor supports 20 commands whose functionality is similar to previously analyzed lazarus samples (note that the command names here did not originate from the attackers but were created by an eset malware analyst): it creates several files on the file system. the listening port is stored in a text file named %windows%\temp\p. the file %windows%\temp\perflog.evt contains a list of paths of binary files to be injected, executed or written to the registry depending upon the beginning character: session hijacker
win64/nukesped.ab is a console application that creates a process as another currently logged-in user on the victim s system (similar to command number 17 from the previously described tcp backdoor). it is a themida-protected variant of a sample described by kaspersky. in our case, it was installed as . it accepts three parameters. a static look shows the same file properties in both these samples: the same pe compilation timestamp, identical rich header linker data (indicating that the linker was visual studio 2010 (10.00)), and part of the resources version info matches: while the pe timestamp and the resources are stolen from the legitimate microsoft file from windows 7 sp1, the linker data was not: the original microsoft file was compiled and linked by visual studio 2008 (9.00). our consequent, dynamic analysis confirmed that this file found in the compromised casino s network is related to the session hijacker used in the polish and mexican attacks. loader/installer
this is a simple command line tool accepting several switches. its purpose is to work with processes (injecting/killing a process by pid or by name), services (terminating/reinstalling a service) or files (drop/remove). its exact functionality depends on the parameters. killdisk variants
killdisk is a generic detection name that eset uses for destructive malware with disk wiping capabilities, such as damaging boot sectors and overwriting then deleting (system) files, followed by a reboot to render the machine unusable. although all killdisk malware has similar functionality, as a generic detection, individual samples do not necessarily have strong code similarities or relationships. such generic malware detections usually have many sub-families , distinguished by the detection suffix (e.g. win32/killdisk.nbo in this case). sub-family variants that do have strong code similarities, are sometimes seen separate cyberattacks and thus can help us make connections, as here. other cases, for example the directed cyberattacks against high-value targets in ukraine in december 2015 and december 2016, also employed killdisk malware, but those samples were from different killdisk sub-families, so are most likely unrelated to these attacks. in the central american online casino case, we detected two variants of win32/killdisk.nbo in their network. this malware was detected on over 100 machines in the organization. there are several possible explanations for its deployment, with the attackers covering their tracks after an espionage operation, or its direct use for extortion or sabotage, being the most probable. in any case, the impact against a single organization is large. based on our telemetry, the simultaneous use of the detected win32/killdisk.nbo variants, and the other known lazarus malware on the targeted network, we are confident this killdisk malware was deployed by lazarus, rather than by another, unrelated attacker. our analysis of these two win32/killdisk.nbo variants revealed that they share many code similarities. further, they are almost identical to the killdisk variant used against financial organizations in latin america, as described by trend micro. in this online casino case, the killdisk variants path was typically: the actual embedded payload is injected into the system process : one of the variants was protected using the commercial pe protector vmprotect in its 3rd generation, which made unpacking it trickier. the attackers most likely did not buy a vmprotect license but have rather used leaked or pirated copies available on the internet. using protectors is common for the lazarus group: during the polish and mexican attacks in february 2017, they made use of enigma protector and some of the operation blockbuster samples, reported by palo alto networks, used an older version of vmprotect. common lazarus format strings
among numerous typical characteristics that let us attribute the samples and attacks to lazarus, one worth pointing out for the sake of other researchers is format strings. the table below lists formatting strings found in the aforementioned samples, as well as in many tcp backdoors linked with lazarus: format string	lazarus attack / report
by itself, this might not seem to be a convincing clue, but checking these format strings against all the malware samples ever collected by eset, the only results are from samples in suspected lazarus operations. hence, we conclude that these format strings represent a relevant, static characteristic of the lazarus group s modus operandi. additional tools
there are (at least) two widely available tools that the attackers in the online casino case also used. browser password dump
this shady tool serves the purpose of recovering passwords from popular web browsers. however, it is a tool from december 2014, which uses old, well-known techniques. nevertheless, it can be used effectively on the current, latest versions of google chrome (64.0.3282.186), chromium (67.0.3364.0), microsoft edge (41.16299.15.0) and microsoft internet explorer (11.0.9600.17843). it does not work against recent versions of firefox or opera. mimikatz
these attackers also used a modified version of the infamous open-source tool mimikatz, which is used for extracting windows credentials. it accepts one parameter the name of the file in which to store the output. if no parameter is given then the output file is called ~ located in the same directory as mimikatz. the output contains hashes of the windows credentials of currently logged-in users. this tool is commonly used by various apt groups and cybercriminals, for example by the telebots group in the massive (aka notpetya) outbreak, or in operation buhtrap. infection vector
most of the tools described above are downloaded and installed onto victim systems by malicious droppers and loaders active in the initial stage of the attack. moreover, we have seen indicators that the attackers leveraged remote access tools, such as radmin 3 and logmein, in order to control machines remotely. conclusion
this recent attack against an online casino in central america suggests that hacking tools from the lazarus toolset are recompiled with every attack (we didn t see these exact samples anywhere else). the attack itself was very complex, consisted of several steps, and involved tens of protected tools that, being stand-alone, would reveal little from their dynamics. utilizing killdisk in the attack scenario most likely served one of two purposes: the attackers covering their tracks after an espionage operation, or it was used directly for extortion or cyber-sabotage. in any case, the fact that eset products detected the malware on over 100 endpoints and servers in the organization signifies a large-scale effort of the attackers.
