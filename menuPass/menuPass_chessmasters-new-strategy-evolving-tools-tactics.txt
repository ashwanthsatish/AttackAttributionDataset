
a few months ago, we covered the chessmaster cyberespionage campaign, which leveraged a variety of toolsets and malware such as chches and remote access trojans like redleaves and plugx to compromise its targets primarily organizations in japan. a few weeks ago, we observed new activity from chessmaster, with notable evolutions in terms of new tools and tactics that weren t present in the initial attacks. from what we ve seen, chessmaster is continuously evolving, using open source tools and ones they developed, likely as a way to anonymize their operations. based on the way the campaign has developed, it won t be surprising to see additional evolutions from chessmaster in the future. infection vector
here is a summary of how chessmaster enters a target system: an exploit document arrives on a target system. this document abuses a soap wsdl parser vulnerability (cve-2017-8759) that affects the microsoft .net framework
it then accesses the remote server 89[.]18[.]27[.]159/ once the victim opens the document, the attacker can execute arbitrary commands on the victim s machine.
the exploit document then launches to access 89[.]18[.]27[.]159:8080/lk0rs, which serves as the first backdoor into the system
this backdoor launches a malicious powershell script
the powershell script downloads and activates the malware located in the remote server 89[.]18[.]27[.]159/ jpg is the second backdoor, which uses the command-and-control (c&c) server62[.]75[.]197[.]131.
as mentioned earlier, the first step of the new campaign involves the use of an exploit document that connects to the remote server 89[.]18[.]27[.]159/ when opened. holds the exploit command, which will execute the content of another remote server, 89[.]18[.]27[.]159:8080/lk0rs, via . the image below shows the malicious link embedded in the exploit document: at this stage, we observed that the attacker tried to gather the system s environment information via command line tools. we also observed that some commands were based on the result of a previous command, which means that not all parts of the attack were automated and that parts of the commands were done manually. while this might be a sign of a more sophisticated automation technique, we believe that this may be an attacker trying to get up close and personal by manually checking the environment before delivering the final payload. it is possible that this was done to avoid sandboxing or analysis by researchers. while we were not able to gather the actual live data of the next step of the attack, we were able to observe koadic and the following script, which tries to download another dll file from the same server that hosts koadic, at the same time. we believe that serves as the final payload of this attack. the script attempts to download the file from (detected by trend micro as bkdr_anel.zkei), a dll file which serves as the second backdoor. the powershell script leverages registerxll, which is a component of excel, to load bkdr_anel into backdoor analysis bkdr_anel is downloaded. once loaded onto the system, it will launch and inject code into , after which the injected code decrypts and activates the embedded backdoor. bkdr_anel has a microsoft signature attached the signature is invalid and likely added to make it seem more harmless. the backdoor has a hardcoded malware version labeled 5.0.0 beta1 that contains basic backdoor routines with a string-like function not implemented. inside. the relatively incomplete code might be a clue of a new variant in the future. the malware s c&c protocol is very similar to the one used by bkdr_chches at first glance: however they are different backdoors, with bkdr_chches employing rc4 as its main encryption algorithm wherein the decryption key is sent with the encrypted information separated by = and set in the cookie header. on the other hand, bkdr_anel utilizes blowfish with the hardcoded encryption key obviously labeled as this is the encrypt key. another difference between the two is that bkdr_chches does not contain any backdoor routines by default. instead, it loads additional modules from the c&c server directly into memory. alternatively, bkdr_anel is more like a regular backdoor embedded with basic backdoor routines. the image and table below illustrate the information bkdr_anel sends, and how bkdr_anel encrypts the information. the information blocks are separated by & . as seen in the image above; the string before = in each block, such as ovg, is not used. further similarities between bkdr_anel and bkdr_chches can be seen in special partial md5 logic. both malware only uses the middle 8 bytes from the regular md5 result. bkdr_chches will use it to encrypt the network traffic, while bkdr_anel uses it as a code branch in the malware encryption routine, although from our analysis, it does not look like it is currently in use. mitigation to combat campaigns like chessmaster, organizations need to make full use of the tools available to them. this includes everything from regularly updating their systems to the latest patches, which minimizes the impact of attacks that leverage vulnerabilities. in addition, the proper use of behavior monitoring, application control, email gateway monitoring, and intrusion/detection systems can help detect any suspicious activities that occur within the network. finally, organizations need to cultivate a culture of security to educate users on what to look out for in terms of potential attacks, as end users are often the primary target of these kinds of campaigns. organizations can also strengthen their security by employing solutions such as trend micro vulnerability protection , which protects endpoints from threats that exploit vulnerabilities via a high-performance engine monitors traffic for new specific vulnerabilities that uses host-based intrusion prevention system (ips) filters as well as zero-day attack monitoring. in addition, comprehensive security solutions can be used to protect organizations from attacks. these include trend micro endpoint solutions such as trend micro smart protection suites, and worry-free business security, which can protect users and businesses from these threats by detecting malicious files, well as blocking all related malicious urls. trend micro deep discovery has an email inspection layer that can protect enterprises by detecting malicious attachment and urls. trend micro officescan with xgen endpoint security infuses high-fidelity machine learning with other detection technologies and global threat intelligence for comprehensive protection against all kinds of threats.
