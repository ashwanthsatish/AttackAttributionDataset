
on aug. 1, 2018, the united states district attorney s office for the western district of washington unsealed indictments and announced the arrests of three individuals within the leadership ranks of a criminal organization that aligns with activity we have tracked since 2015 as fin7. these malicious actors are members of one of the most prolific financial threat groups of this decade, having carefully crafted attacks targeted at more than 100 organizations. fin7 is referred to by many vendors as carbanak group, although we do not equate all usage of the carbanak backdoor with fin7. this blog explores the range of fin7's criminal ventures, the technical innovation and social engineering ingenuity that powered their success, a glimpse into their recent campaigns, their apparent use of a security company as a front for criminal operations, and what their success means for the threat landscape moving forward. with this release, fireeye is also providing technical context, historical indicators, and techniques that organizations can use to hunt for fin7 behavior enterprise-wide. fin7 does the crime...
the threat group is characterized by their persistent targeting and large-scale theft of payment card data from victim systems, which it has monetized at least a portion of through a prominent card shop. but fin7 s financial operations were not limited to card data theft. in some instances, when they encountered and could not obtain payment card data from point of sale (pos) systems secured with end-to-end encryption (e2ee) or point-to-point encryption (p2pe), fin7 pivoted to target finance departments within their victim organizations. furthermore, in april 2017, fireeye reported that fin7 sent spear phishing emails to personnel involved with united states securities and exchange commission (sec) filings at multiple organizations, providing further insight into fin7 s targeting. these targeted individuals would likely have access to material non-public information that fin7 actors could use to gain a competitive advantage in stock trading. diversification of their monetization tactics has allowed the group to impact a wide range of industries beyond those solely associated with payment card industry. during campaigns that fireeye associates with fin7, victims within the following sectors have been targeted within the united states and europe: restaurants
hospitality
casinos and gaming
energy
finance
high-tech
software travel
education
construction
retail
telecommunications
government
business services
fin7 s innovation enabled their success
throughout fireeye s tracking of fin7 campaigns, the attackers have attempted to stay ahead of the game and thwart detection, using novel tactics and displaying characteristics of a well-resourced operation. for example, in april 2017, fireeye blogged about fin7 s spear phishing emails that leveraged hidden shortcut files (lnk files) to initiate the infection and vbscript functionality launched by to infect the victim. this was a direct departure from their established use of weaponized office macros and highlighted the group s adaptive nature to evade detection. fireeye also previously reported on fin7 s use of the carbanak backdoor as a post-exploitation tool to cement their foothold in a network and maintain access to victim environments. carbanak is well known for its use in highly profitable and sophisticated attacks dating back to 2013, with usage attributable to fin7 beginning in late 2015, although how interconnected the campaigns employing the malware over this five-year span are is unclear. fin7 s use of carbanak is particularly notable due to their use of creative persistence mechanisms to launch the backdoor. the group leveraged an application shim database that injected a malicious in-memory patch into the services control manager (" ") process, and then spawned a carbanak backdoor process. fin7 also used this tactic to install a payment card harvesting utility. another notable characteristic of fin7 has been their heavy use of digital certificates. unsurprisingly, malicious threat actors have sought to exploit the legitimacy afforded by these certificates. by digitally signing their phishing documents, backdoors and later stage tools, fin7 was able to bypass many security controls that may limit execution of macros from office documents and restrict execution of unsigned binaries on trusted systems. organization country serial email table 1: sample fin7 code signing certificates fin7 developed evasive techniques at a rapid pace. throughout 2017, fin7 was observed creating novel obfuscation methods, and in some cases modifying the methods on a daily basis while launching attacks targeting multiple victims. the threat group regularly tested malicious doc, docx, and rtf phishing documents against public repositories to check static detection engine coverage. their development of a payload obfuscation style using the windows command interpreter's ( ) native string substitution was so unique that fireeye dubbed it "fincoding." these methods inspired deep command line obfuscation research and the release of daniel bohannon's invoke-dosfuscation. reference table 2 and table 3 for a selection of samples and their associated command line obfuscation techniques. fin7 s relentless phone calls and bellyaching
over the three years of responding to a multitude of compromises and proactively defending against fin7, fireeye observed unprecedented social engineering prowess. from leveraging web forms for initial contact to targeting and engaging directly with pre-determined store managers, the operators demonstrated a range of capabilities. fin7 s reach extended beyond their targets computer systems. fireeye has responded to incidents where fin7 has called victims prior to lodging digital complaints laden with malicious documents as well as after the phishing documents have been sent, in order to check if they were received a crude but effective fin7 email delivery tracking technique. as fin7 has matured, so did the quality of their phishing lures and templates, which were most often sent from fake but thoroughly disguised individuals and businesses and occasionally from sender addresses impersonating legitimate government entities. their phishing has often exploited urgent, high value business matters tailored to their chosen targets. at individual stores, managers were contacted about lost items or sent a receipt claiming overcharging. other fin7 phishing emails masqueraded as detailed catering orders or requests for special menus tailored to individuals with dietary restrictions. in early 2017, a pattern of complaints emerged and has continued for well over a year, where fin7 has contacted stores and corporate offices to lodge food poisoning complaints with malicious attachments. internally dubbed findigestion by fireeye, this pattern of detailed complaints eventually expanded beyond individual complaints and into litigious concerns raised on behalf of the government , as shown in figure 1. figure 1: fda themed spear phishing email it is noteworthy that the bateleur backdoor activity first identified by proofpoint in july 2017, which fireeye tracks as a suspected fin7 subgroup, uses highly-customized graphics for their targets, often created in adobe photoshop. in this same phishing campaign, fin7 s malicious attachment was graphically themed to match, as shown in figure 2. figure 2: fda themed spear phishing attachment throughout their operations, the professional design and continued development of phishing elements in parallel to other post-compromise tools indicated to fireeye that fin7 was most likely a well-resourced criminal operation. it s just metadata
fireeye has tracked several fin7 personas throughout their operations by collecting and parsing filetypes of forensic value for juicy metadata. in a previous blog, we shared how lnk files created by fin7 unintentionally revealed valuable information about their development environment. lnk files can contain metadata that reveals attributes about the systems on which the lnks were created, including original file paths, volume serial numbers, mac addresses, and hostnames. by studying values within the lnk metadata we often identify "toolmarks," or unique values associated with distinct malware developer and operator personas. fin7 lnk metadata shows that the actors routinely used virtual machines with generic hostnames such as andy-pc or user-pc, and default hostnames with the structure win-[a-z0-9]{11} (e.g. win-abcdefgh1jk). fireeye has tracked several hostname and path toolmarks associated with fin7 s operations, which we have used to link clusters of threat activity together. these toolmarks may be linked to fin7 members who are involved in tool development or the broader criminal operation. notable personas from the technical data, which are explored in more detail in the technical appendix section, include: this analysis allowed us to understand fin7 s systems and correlate future attack activity to the different personas. furthermore, the metadata analysis helped us monitor for files generated by the group and use the established toolmarks to establish detection for other adversary methodologies (such as direct rdp or smb access) if the group changed ttps. video playback of fin7 operations
while responding to multiple fin7 intrusions, fireeye recovered a custom video recording capability used by fin7 as a part of their operations. fireeye s flare team reverse engineered the video protocol, which appeared to be custom-written by fin7 as it has no external library dependencies, contained cyrillic comments in the code, and required the use of a bespoke video player unique to fin7. the attackers most likely leveraged this video recording capability in their arsenal to monitor operations in victim environments to inform later stages of their intrusions. fireeye obtained a version of the criminal developers video player from a trusted source and with the knowledge of the reverse engineered protocol, the flare team modified the source code to support multiple versions of fin7 s custom encoding. with the patched source code, fireeye can decode and playback fin7 s video monitoring for affected victims in possession of these files. recent shifts in fin7 operations
throughout 2018, fireeye has continued to identify multiple domains registered using patterns consistent with prior fin7 activity, as well as campaigns using disparate ttps that we have attributed to fin7 with varying degrees of confidence. zip archives delivering the birddog backdoor were hosted on a portion of suspected fin7 domains registered in 2018. some evidence further characterizing the nature of this campaign suggests these malicious documents were sent to financial institution customers in eastern europe and central asia as early as september 2017. the targeting of individuals rather than organizations would mark a significant shift in their targeting, although it is also possible that the banks spoofed in these campaigns were fin7's ultimate targets. additionally, we have identified similarities between fin7 activity and bateleur campaigns, which began as early as mid-2017 and have been primarily aimed at u.s.-based restaurant chains. these campaigns leveraged macro-embedded word documents directly attached to the emails as well as ones hosted on google drive. the documents were meticulously crafted to appear as though they came from legitimate organizations (e.g. restaurant associations and suppliers of pos hardware). this suspected fin7 activity continued past the date of most recent arrest announced by u.s. law enforcement, although the attackers are now leveraging an updated javascript backdoor dubbed griffon. these recent campaigns could be representative of a decisive effort to diversify ttps to avoid detection or could indicate the formation of fin7 splinter groups carrying out autonomous campaigns. as a result, organizations need to remain vigilant and continue to monitor for changes in the methods employed by the fin7 actors. unveiling fin7 s front company and industry figure 3: combi security logo as retrieved from 2016 cache of according to u.s. law enforcement, at least a portion of fin7 activity was run out of a front company dubbed combi security. a cache of its website reveals that the company purported to be the world leaders in the field of comprehensive protection of large information systems from modern cyber threats with headquarters in moscow, haifa, and odessa. we have identified job advertisements for combi security that have been posted on popular russian, ukrainian, and uzbek job recruitment sites, as well as numerous individuals who most likely worked for the company. due to the seeming legitimacy of the recruitment postings, some individuals may have been unaware of illicit nature of their work. while the recruitment of unwitting individuals as puppets has been a common component of at least some criminal schemes for example, reshipping mules who are recruited through postings on career sites advertising attractive work-from-home jobs fin7 s veiling of full-scale financial compromises as legitimate offensive security engagements is particularly notable. the apparent success of combi security in recruiting unsuspecting individuals in this manner, may lead to more of this type of technical recruitment by cyber criminals in the future. splitting up?
the criminal organization behind fin7 is almost certainly comprised of many additional individuals beyond those already apprehended by law enforcement authorities. fireeye isight intelligence expects that at least a portion of these malicious actors are likely to continue conducting cyber crime activity in some capacity. although we expect activity to continue, it is extremely common for threat actors to either modify their ttps or temporarily halt operations following significant developments such as arrests of high-level members and/or public disclosure of ttps that they employ. depending on the organizational and communication structure of the group, it is also plausible that multiple subgroups could form and carry out independent operations in the future. recent campaigns, as well as those using tactics that were atypical for historical fin7 campaigns, such as the sec campaigns with widespread targeting, may be representative of semi-autonomous groups pre-existing within, or cooperating with, the fin7 criminal organization. as noted in our carbanak overview, certain malware families and techniques transcend strictly defined threat groups, and may be re-used by developers and operators as they transition between organizations and campaigns. conclusion
these recent announcements by u.s. law enforcement highlight the positive impact that can result from synergy between private and public sector organizations in disrupting organized cyber crime operations. as demonstrated by fin7, financially-motivated threat actors are becoming extremely advanced and are capable of inflicting significant harm on organizations through vast, but carefully orchestrated campaigns. as sophisticated threat groups continue to emerge, partnerships, such as those exhibited here, will almost certainly play a key role in combating these threats. acknowledgements
jordan nuce, tom bennett, michael bailey, and daniel bohannon technical appendix
fireeye has responded to many fin7 incidents, which has provided us extensive insight into their operations. as part of this blog post, we are also including numerous indicators that we attribute to fin7 and an overview of their techniques to aid organizations in identifying malicious activity across their networks. phishing documents technical details
in addition to lnk metadata, fin7 phishing documents consistently contained artifacts detailing the local file system paths of component files used to construct the spear phishing documents. in the following tables, we have also included examples of the myriad of command line obfuscation techniques used by fin7. of particular note is the quick turnaround time between documents employing different techniques. 