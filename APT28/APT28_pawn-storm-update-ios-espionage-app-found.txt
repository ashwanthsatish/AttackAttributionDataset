pawn storm update: ios espionage app found
posted on:february 4, 2015 at 12:00 am
posted in:malware, targeted attacks
author: lambert sun, brooks hong (mobile threat analysts), feike hacquebord (senior threat researcher) in our continued research on operation pawn storm, we found one interesting poisoned pawn spyware specifically designed for espionage on ios devices. while spyware targeting apple users is highly notable by itself, this particular spyware is also involved in a targeted attack. trend micro mobile security detects and removes this threat. download the app from the app store: trend micro mobile security privacy & lost device protection for your iphone, ipad, and ipod touch. background of operation pawn storm operation pawn storm is an active economic and political cyber-espionage operation that targets a wide range of entities, like the military, governments, defense industries, and the media. the actors of pawn storm tend to first move a lot of pawns in the hopes they come close to their actual, high profile targets. when they finally successfully infect a high profile target, they might decide to move their next pawn forward: advanced espionage malware. the ios malware we found is among those advanced malware. we believe the ios malware gets installed on already compromised systems, and it is very similar to next stage sednit malware we have found for microsoft windows systems. we found two malicious ios applications in operation pawn storm. one is called xagent (detected as ios_xagent.a) and the other one uses the name of a legitimate ios game, madcap (detected as ios_ ). after analysis, we concluded that both are applications related to sednit. the obvious goal of the sednit-related spyware is to steal personal data, record audio, make screenshots, and send them to a remote command-and-control (c&c) server. as of this publishing, the c&c server contacted by the ios malware is live. analysis of xagent the xagent app is fully functional malware. after being installed on ios 7, the app s icon is hidden and it runs in the background immediately. when we try to terminate it by killing the process, it will restart almost immediately. installing the malware into an ios 8 device yields different results. the icon is not hidden and it also cannot restart automatically. this suggests that the malware was designed prior to the release of ios 8 last september 2014. data theft capabilities the app is designed to collect all kind of information on an ios device. it is able to perform the following routines: collect text messages
get contact lists
get pictures
collect geo-location data
start voice recording
get a list of installed apps
get a list of processes
get the wi-fi status figure 1. xagent code structure c&c communication besides collecting information from the ios device, the app sends the information out via http. it uses post request to send messages, and get request to receive commands. formatted log messages the malware s log messages are written in html and color coded, making it easier for human operators to read. error messages tend to be in red, while others are in green as shown in the figure below. a well-designed code structure we can see that the code structure of the malware is very organized. the malware looks carefully maintained and consistently updated. the app uses the commands watch, search, find, results, open, and close. randomly generated uri the full uniform resource identifier (uri) for c&c http requests is randomly generated, according to a template agreed upon with the c&c server. the base uri can be seen in figure 4, and parameters are chosen from the list below and appended to the base uri. here are corresponding implementations we got during our reversing: token format and encoding the malware uses a token to identify which module is communicating. the token is base64 encoded data, but padded with a 5-byte random prefix so that it looks like valid base64 data. see the first line ai= part in the figure below. reverse engineering also revealed additional communication functions. ftp communication the app is also able to upload files via ftp protocol. analysis of madcap madcap is similar to the xagent malware, but the former is focused on recording audio. madcap can only be installed on jailbroken devices. possible infection methods the exact methods of installing these malware is unknown. as far as we can tell the ios device has to be jailbroken to install the xagent malware. however we have seen one instance wherein a lure involving xagent simply says tap here to install the application. figure 13. site used in downloading xagent it is good to note that it is still possible to install the malicious app into non-jailbroken devices if the app is signed using apple s enterprise certificate. another possible scenario is infecting an iphone after connecting it to a compromised or infected windows laptop via a usb cable.
to learn more about this campaign, you may refer to our report, operation pawn storm using decoys to evade detection. trend micro mobile security protects users ios devices and stops threats before they reach them. trend micro mobile security offers protection and detects these malware using the cloud-based smart protection network and mobile app reputation technology. 