sofacy, also known as apt28, fancy bear, and tsar team, is a highly active and prolific apt. from their high volume 0day deployment to their innovative and broad malware set, sofacy is one of the top groups that we monitor, report, and protect against. 2017 was not any different in this regard. our private reports subscription customers receive a steady stream of yara, ioc, and reports on sofacy, our most reported apt for the year. this high level of cyber-espionage activity goes back years. in 2011-2012, the group used a relatively tiny implant (known as sofacy or sourface) as their first stage malware, which at the time had similarities with the old miniduke implants. this made us believe the two groups were connected, although it looks they split ways at a certain point, with the original miniduke group switching to the cosmicduke implant in 2014. the division in malware was consistent and definitive at that point. in 2013, the sofacy group expanded their arsenal and added more backdoors and tools, including coreshell, splm (aka xagent, aka chopstick), jhuhugit (which is built with code from the carberp sources), azzy (aka advstoreshell, netui, eviltoss, and spans across 4-5 generations) and a few others. we ve seen quite a few versions of these implants, which were relatively widespread at some point or still are. in 2015 we noticed another wave of attacks which took advantage of a new release of the azzy implant, largely undetected by antivirus products. the new wave of attacks included a new generation of usb stealers deployed by sofacy, with initial versions dating to february 2015. it appeared to be geared exclusively towards high profile targets. sofacy s reported presence in the dnc network alongside apt29 brought possibly the highest level of public attention to the group s activities in 2016, especially when data from the compromise was leaked and weaponized . and later 2016, their focus turned towards the olympics and the world anti-doping agency (wada) and court of arbitration for sports (cas), when individuals and servers in these organizations were phished and compromised. in a similar vein with past cyberberkut activity, attackers hid behind anonymous activist groups like anonpoland , and data from victimized organizations were similarly leaked and weaponized . this write-up will survey notables in the past year of 2017 sofacy activity, including their targeting, technology, and notes on their infrastructure. no one research group has 100% global visibility, and our collected data is presented accordingly. here, external apt28 reports on 2017 darkhotel-style activity in europe and dealer s choice spearphishing are of interest. from where we sit, 2017 sofacy activity starts with a heavy focus on nato and ukrainian partners, coinciding with lighter interest in central asian targets, and finishing the second half of the year with a heavy focus on central asian targets and some shift further east. dealer s choice
the beginning of 2017 began with a slow cleanup following the dealer s choice campaign, with technical characteristics documented by our colleagues at palo alto in several stages at the end of 2016. the group spearphished targets in several waves with flash exploits leading to their carberp based jhuhugit downloaders and further stages of malware. it seems that many folks did not log in and pull down their emails until jan 2017 to retrieve the dealer s choice spearphish. throughout these waves, we observed that the targets provided connection, even tangential, to ukraine and nato military and diplomatic interests. in multiple cases, sofacy spoofs the identity of a target, and emails a spearphish to other targets of interest. often these are military or military-technology and manufacturing related, and here, the dealerschoice spearphish is again nato related: the global reach that coincided with this focus on nato and the ukraine couldn t be overstated. our ksn data showed spearphishing targets geolocated across the globe into 2017. dealerschoice emails, like the one above, that we were able to recover from third party sources provided additional targeting insight, and confirmed some of the targeting within our ksn data: 0day deployment(s)
sofacy kicked off the year deploying two 0day in a spearphish document, both a microsoft office encapsulated postscript type confusion exploit and an escalation of privilege use-after-free exploit (abusing cve-2017-0263). the group attempted to deploy this spearphish attachment to push a small 30kb backdoor known as gamefish to targets in europe at the beginning of 2017. they took advantage of the syrian military conflict for thematic content and file naming. again, this deployment was likely a part of their focus on nato targets. light splm deployment in central asia and consistent infrastructure
meanwhile in early-to-mid 2017, detections in central asia provided a glimpse into ongoing focus on ex-soviet republics in central asia. these particular detections are interesting because they indicate an attempted selective 2nd stage deployment of a backdoor maintaining filestealer, keylogger, and remoteshell functionality to a system of interest. as the latest revision of the backdoor, portions of splm didn t match previous reports on splm/xagent while other similarities were maintained. splm 64-bit modules already appeared to be at version 4 of the software by may of the year. targeting profiles included defense related commercial and military organizations, and telecommunications. heavy zebrocy deployments
since mid-november 2015, the threat actor referred to as sofacy or apt28 has been utilizing a unique payload and delivery mechanism written in delphi and autoit. we collectively refer to this package and related activity as zebrocy and had written a few reports on its usage and development by june 2017 sofacy developers modified and redeployed incremented versions of the malware. the zebrocy chain follows a pattern: spearphish attachment -> compiled autoit script (downloader) -> zebrocy payload. in some deployments, we observed sofacy actively developing and deploying a new package to a much smaller, specific subset of targets within the broader set. targeting profiles, spearphish filenames, and lures carry thematic content related to visa applications and scanned images, border control administration, and various administrative notes. targeting appears to be widely spread across the middle east, europe, and asia: business accounting practices and standards
science and engineering centers
industrial and hydrochemical engineering and standards/certification
ministry of foreign affairs
embassies and consulates
national security and intelligence agencies
press services
translation services
ngo family and social service
ministry of energy and industry
we identified new msil components deployed by zebrocy. while recent zebrocy versioning was 7.1, some of the related zebrocy modules that drop file-stealing msil modules we call covfacy were v7.0. the components were an unexpected inclusion in this particular toolset. for example, one sent out to a handful of countries identifies network drives when they are added to target systems, and then rc4-like-encrypts and writes certain file metadata and contents to a local path for later exfiltration. the stealer searches for files 60mb and less with these extensions: at execution, it installs an application-defined windows hook. the hook gets windows messages indicating when a network drive has been attached. upon adding a network drive, the hook calls its recordtofile file stealer method. zebrocy spearphishing targets: splm deployment in central asia
splm/chopstick components deployed throughout 2017 were native 64-bit modular c++ windows com backdoors supporting http over fully encrypted tlsv1 and tlsv1.2 communications, mostly deployed in the second half of 2017 by sofacy. earlier splm activity deployed 32-bit modules over unencrypted http (and sometimes smtp) sessions. in 2016 we saw fully functional, very large splm/x-agent modules supporting os x. the executable module continues to be part of a framework supporting various internal and external components communicating over internal and external channels, maintaining slightly morphed encryption and functionality per deployment. sofacy selectively used splm/chopstick modules as second stage implants to high interest targets for years now. in a change from previous compilations, the module was structured and used to inject remote shell, keylogger, and filesystem add-ons into processes running on victim systems and maintaining functionality that was originally present within the main module. the newer splm modules are deployed mostly to central asian based targets that may have a tie to nato in some form. these targets include foreign affairs government organizations both localized and abroad, and defense organizations presence localized, located in europe and also located in afghanistan. one outlier splm target profile within our visibility includes an audit and consulting firm in bosnia and herzegovina. minor changes and updates to the code were released with these deployments, including a new mutex format and the exclusive use of encrypted http communications over tls. the compiled code itself already is altered per deployment in multiple subtle ways, in order to stymie identification and automated analysis and accommodate targeted environments. strings (c2 domains and functionality, error messages, etc) are custom encrypted per deployment. splm/chopstick/xagent modularity and infrastructure
this subset of splm/chopstick activity leads into several small surprises that take us into 2018, to be discussed in further detail at sas 2018. the group demonstrates malleability and innovation in maintaining and producing familiar splm functionality, but the pragmatic and systematic approach towards producing undetected or difficult-to-detect malware continues. changes in the second stage splm backdoor are refined, making the code reliably modular. infrastructure notes
sofacy set up and maintained multiple servers and c2 for varying durations, registering fairly recognizable domains with privacy services, registrars that accept bitcoin, fake phone numbers, phony individual names, and 1 to 1 email address to domain registration relationships. some of this activity and patterns were publicly disclosed, so we expect to see more change in their process in 2018. also, throughout the year and in previous years, researchers began to comment publicly on sofacy s fairly consistent infrastructure setup. as always, attackers make mistakes and give away hints about what providers and registrars they prefer. it s interesting to note that this version of splm implements communications that are fully encrypted over https. as an example, we might see extraneous data in their ssl/tls certificates that give away information about their provider or resources. leading up to summer 2017, infrastructure mostly was created with pdr and internet domain service bs corp, and their resellers. hosting mostly was provided at fast serv inc and resellers, in all likelihood related to bitcoin payment processing. accordingly, the server side certificates appear to be generated locally on vps hosts that exclusively are paid for at providers with bitcoin merchant processing. one certificate was generated locally on what appeared to be a hp-ux box, and another was generated on with an email address , as seen here for their nethostnet[.]com domain. this certificate configuration is ignored by the malware. in addition to other ip data, this data point suggested that qhoster at was a vps hosting reseller of choice at the time. it should be noted that the reseller accepted alfa click, paypal, payza, neteller, skrill, webmoney, perfect money, bitcoin, litecoin, solidtrust pay, cashu, ukash, okpay, egopay, paysafecard, alipay, mg, western union, sofort banking, qiwi, bank transfer for payment. conclusion
sofacy, one of the most active apt we monitor, continues to spearphish their way into targets, reportedly widely phishes for credentials, and infrequently participates in server side activity (including host compromise with beef deployment, for example). ksn visibility and detections suggests a shift from their early 2017 high volume nato spearphish targeting towards the middle east and central asia, and finally moving their focus further east into late 2017. their operational security is good. their campaigns appear to have broken out into subsets of activity and malware involving gamefish, zebrocy, and splm, to name a few. their evolving and modified splm/chopstick/xagent code is a long-standing part of sofacy activity, however much of it is changing. we ll cover more recent 2018 change in their targeting and the malware itself at sas 2018. with a group like sofacy, once their attention is detected on a network, it is important to review logins and unusual administrator access on systems, thoroughly scan and sandbox incoming attachments, and maintain two factor authentication for services like email and vpn access. in order to identify their presence, not only can you gain valuable insight into their targeting from intelligence reports and gain powerful means of detections with hunting tools like yara, but out-of-band processing with a solution like kata is important. apt backdoor campaigns cyber espionage nation state sponsored espionage sofacy targeted attacks vulnerabilities and exploits zero-day vulnerabilities
