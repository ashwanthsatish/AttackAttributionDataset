digital attack on german parliament: investigative report on the hack of the left party infrastructure in bundestag servers of the left in german bundestag have been infected with malware, apparently by a state-sponsored group of russian origin. this is the summary of an analysis by an it security researcher, which we publish in full. the in-depth report provides an analysis of technology, impact, possible attribution and a signature to detect the malware. summary of findings
two suspicious artifacts have been retrieved from two separate servers within the die linke infrastructure. one is an open source utility used to remotely issue commands on a windows host from a linux host. the other is a custom utility which, despite its large size, has limited functionality and acts as a tunnel, possibly used by the attackers to maintain persistence within the compromised network. the combination of the two utilities seems to be enough for the attackers to maintain a foothold inside the network, harvest data, and exfiltrate all the information they deemed interesting. it is, however, possible that there are additional malicious artifacts which have not yet been discovered. attributes of one of the artifacts and intelligence gathered on the infrastructure operated by the attackers suggest that the attack was perpetrated by a state-sponsored group known as sofacy (or apt28). previous work published by security vendor fireeye in october 2014 suggests the group might be of russian origin. artifacts
the first artifact identified across this report as artifact #1 has the following attributes:
rtifact #1 was retrieved from a file server operated by die linke. the file is a 64bit-compatible compiled binary of the open source utility winexe. winexe is software similar to the more popular psexec and is designed to allow system administrators to execute commands on remote servers. while commercial solutions like symantec pcanywhere provide a larger feature-set, winexe is lightweight, and doesn t require any installation or configuration. one of the reasons winexe is preferred over psexec, is that it provides a linux client, while psexec doesn t. attackers are making growing use of utilities like winexe and psexec to perform lateral movement across compromised networks. besides providing the ability to execute arbitrary commands on the target system, these utilities normally don t raise suspicion as they are commonly whitelisted by antivirus and other commercial security software. winexe acts as a windows service that can be configured to automatically start at boot and silently wait for incoming commands over a named pipe. named pipes are a windows inter-process communication method. through named pipes, processes are able to communicate and exchange data even over a network. in the case of artifact #1, the name of the pipe is ahexec , computers over the network could access the pipe server by simply opening a file handle on \servernamepipeahexec . once connected to the pipe, a user or a program can easily provide information required to execute command (just as they would normally through a command-line). the provided information is then passed to a createprocessasusera call and the specified command is executed. once inside the network, artifact #1 can be enough for the attacker to download or create additional scripts, execute commands and exfiltrate data (for example, simply through ftp). it is plausible that artifact #1 could be present on other servers under different names, although it is also likely that the attacker only left it on servers to which they required maintainenance of persistent access. it is important that all the deployments of this utility are identified and removed, as they are self-sufficient and they provide easy and open access to execute commands on the host, potentially with administrator privileges. analysis of artifact #2
artifact #2 was recovered from the admin controller operated by die linke. this is custom malware, which despite large file size (1,1 mb), provides limited functionality. artifact #2 operates as a backchannel for the attacker to maintain a foothold inside the compromised network. the properties of the artifact show that the same authors of the malware seem to have called it xtunnel . as the same name suggests, the artifact appears in fact to act as a tunnel for the attacker to remotely access the internal network and maintain persistence. the artifact is dependent on a working network connection in order to function properly. in case connectivity can t be established, the process will lock in an endless loop as shown in the behavioral schema below: networkschema connection after initialization, the artifact will attempt to establish a connection by creating a socket. in case of failure, it will sleep for three seconds and try again. the authors of the malware didn t appear to have spent any effort in concealing indicators or obfuscating code the ip address with which it tries to communicate is hardcoded in clear-text inside the binary. we can observe below, the procedure through which the artifact attempts to establish a connection with the ip address : this specific ip address is a critical piece of information that enables us to connect this attack to a spree of previous targeted campaigns. the details of this attribution is explained in a dedicated section below. we will refer to this ip address as command & control (or c&c ). the artifact is able of receiving multiple arguments, including -si, -sp, -up, -pp, -pi and -ssl. following are the beaconing packets the artifact will send to command & control:
f the argument -ssl is given through command-line to the artifact, these beacons will be encapsulated in an ssl connection and a proper tls handshake will be initiated with the c&c. interestingly, the artifact bundles a copy of openssl 1.0.1e, from february 2013, which causes the unusually large size of the binary. more importantly, the command & control server ( ) also appears to be using an outdated version of openssl and be vulnerable to heartbleed attacks. while unlikely, it is worth considering that the same c&c server might have been the subject of 3rd-party attacks due to this vulnerability. if connections to the c&c are blocked or terminated through a firewall, the artifact will be inhibited, as it doesn t seem to have any fallback protocol. additionally, since it does not execute any other functionality autonomously, it would no longer be a direct threat. a yara signature to detect this artifact is provided in the appendix. analysis of impact
despite the simplicity of the tools collected from the compromise, the impact of the attack and the capabilities of the attackers are not to be underestimated. from a purely operational point of view, the combination of a tunnel and a command execution utility are more than enough for an attacker with sufficient privileges to move across a network undisturbed. it is worth noting that artifact #2 was compiled by the authors on april 22nd 2015, which suggests that the compromise may only have lasted a couple of weeks. as the attackers appear largely unconcerned with hiding their tracks or maintaining long-term persistence access (for example, they didn t appear to have attempted to create additional network administrator accounts), it is probable that the operation was intentionally planned to be executed quickly in order to opportunistically collect and exfiltrate as much data as possible. this is further corroborated by a recovered batch file with the following content: his script identifies all pdf and office documents dated after may 1st (specified in the date format supported by microsoft windows in german language) and collects them in a folder, supposedly ready to be exfiltrated. while inone of the recovered artifacts appears to provide dedicated exfiltration functionality, the attacker may have uploaded the documents through a common utility like ftp. it is probable that a previous version of the script was used to collect and exfiltrate documents dated prior to may 1st 2015. due to the nature of the attacker and their modus operandi (which we ll describe in the attribution section below), we can not exclude the possibility that additional, more sophisticated artifacts have been deployed and either remain currently unidentified, or were removed upon discovery and public disclosure of the incident. these considerations suggest that the compromise was perpetrated by an experienced attacker. attribution
while attribution of malware attacks is rarely simple or conclusive, during the course of this investigation i uncovered evidence that suggests the attacker might be affiliated with the state-sponsored group known as sofacy group (also known as apt28 or operation pawn storm). although we are unable to provide details in support of such attribution, previous work by security vendor fireeye suggests the group might be of russian origin, however no evidence allows to tie the attacks to governments of any particular country. sofacy is a group dedicated to the compromise of high-profile targets and the theft of confidential information. they appear to have been active since 2006. they are believed to have successfully attacked the ministries of internal and foreign affairs of several ex-soviet countries, as well as eastern european governments and military institutions, and nato and the white house. sofacy is known for making extensive use of phishing attacks to lure targets into revealing their credentials via realistic reconstruction of internal systems, such as webmails, as employed against the georgian ministry of internal affairs in the infamous attacks that preceded the georgian invasion of 2008: webmail in order to make the phishing attempts more credible, sofacy group has made use of typesquatting , intentionally using spelling mistakes (for example, replacing letters i with l and g with q , or by adding punctuation) to register domains very similar to the original legitimate ones: hile sofacy is also known to use of custom exploit frameworks and spear-phishing attacks, it is possible in this case that they managed to obtain privileged credentials of network administrators within the bundestag through the use of a phishing attack, which then allowed them to navigate through the network and gain access to more data. it is worth noting that shortly before the attack, security vendors reported the use of 0-day exploits in flash player and microsoft windows by the same threat actor. shared command & control infrastructure while the artifacts don t appear to show attributes useful for attribution, the network infrastructure used during the attack led instead to interesting results. during investigation of the command & control server we managed to identify some operational mistakes made by the attackers, allowing us to connect the incident with attacks previously associated with the sofacy group. the address, , is a dedicated server provided by the french ovh hosting company, but is apparently operated by an offshore secure hosting company called and seemingly located in pakistan: it is common for attackers to make use of offshore hosting facilities which are less likely to cooperate with law enforcement on takedown requests or requests of disclosure of their customers identity. crookservers appears to have servers scattered in a number of datacenters and dedicated server hosting providers around the world. by researching historical data relevant to , we discovered that on february 16th 2015, the server was sharing an ssl certificate with another ip address allocated to crookservers and also hosted at ovh: the recovered shared ssl certificate, obtained by a public internet-wide scanning initiative, at the time had the following attributes: s shown, the certificate uses as a common name. this suggests that this certificate might have been previously used for a similar attack against the ukrainian ministry of foreign affairs, or associated targets, although there is no documentation of such attack available to the public. qov more importantly, the ip address this certificate was shared with was previously identified as used by sofacy group for phishing attacks against albanian government institutions by registering the domain (notice, the letter q instead of g ) and creating realistic subdomains to lure victims into visiting. the domain was active on the ip from july 2014 up until march 2015. these attacks against albanian government institutions by the sofacy group were documented and reported by consultancy corporate pwc in december 2014. it is worth noting that this server also seems to be operated by crookservers, since among other domains, 454- resolved to the same ip address. similar artifacts and root9b report while the evidence presented strongly suggests a connection with the sofacy group, the artifacts (in particular artifact #2) are not publicly recognized to be part of the more traditional arsenal of these attackers. nevertheless, on may 12th 2015 (a few weeks after the attack against bundestag appears to have started) the american security firm root9b released a report containing details on malware samples very similar to artifact #2. the report also includes a mention of the same ip address used as command & control server in the attack against bundestag
while the report appears to contain numerous inaccuracies, some of the indicators of compromises are legitimate and appear to be correctly attributed to sofacy. following are hashes for malware artifacts showing very similar attributes to artifact #2: 